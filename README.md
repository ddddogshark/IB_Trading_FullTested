# TQQQ智能交易策略

## 📊 项目概述

这是一个基于EMA20移动平均线的TQQQ自动化交易策略，使用Interactive Brokers (IB) API进行实盘交易。

## 🎯 策略特点

- **交易标的**: TQQQ (3倍杠杆纳斯达克ETF)
- **信号指标**: EMA20指数移动平均线
- **买入条件**: 昨日收盘价 > EMA20
- **仓位管理**: 账户资金的10%
- **执行时间**: 每天北京时间21:20自动检查
- **交易模式**: 实盘交易

## 📁 项目结构

```
IB_Trading/
├── ib_async/                    # 主项目目录
│   ├── tqqq_trading.py         # 主策略文件
│   ├── test_strategy.py        # 策略测试脚本
│   ├── venv/                   # Python虚拟环境
│   └── tqqq_trading.log        # 策略日志文件
├── requirements.txt             # Python依赖包
├── 启动TQQQ策略.bat            # 策略启动脚本
├── 测试TQQQ策略.bat            # 策略测试脚本
├── 环境检测.bat                # 环境检测工具
├── 策略说明.md                 # 详细策略说明
├── Python环境问题解决.md       # Python环境问题解决指南
└── README.md                   # 项目说明文件
```

## 🚀 快速开始

### 1. 环境准备

确保您的系统已安装：
- Python 3.8+
- Interactive Brokers Gateway
- 有效的IB账户

### 2. 启动方式

#### 方式一：使用批处理脚本（推荐）
```bash
# 启动策略
双击 "启动TQQQ策略.bat"

# 测试策略
双击 "测试TQQQ策略.bat"

# 检测环境
双击 "环境检测.bat"
```

#### 方式二：手动运行
```bash
# 进入项目目录
cd ib_async

# 激活虚拟环境
venv\Scripts\activate

# 安装依赖
pip install -r ..\requirements.txt

# 运行策略
python tqqq_trading.py

# 运行测试
python test_strategy.py
```

## 📊 策略执行流程

1. **环境初始化** - 创建策略实例，设置连接参数
2. **连接IB Gateway** - 建立与IB服务器的连接
3. **创建交易合约** - 创建TQQQ股票合约
4. **获取历史数据** - 获取30天日线数据
5. **计算技术指标** - 计算EMA20移动平均线
6. **分析交易条件** - 判断是否满足买入条件
7. **获取账户信息** - 获取账户总价值
8. **计算仓位大小** - 基于账户资金计算买入股数
9. **获取当前价格** - 获取TQQQ实时价格
10. **执行买入订单** - 下市价买单
11. **时间检查** - 确保在指定时间执行

## ⚠️ 重要提醒

### 风险提示
- **实盘交易**: 这是实盘交易策略，将实际扣款并执行交易
- **杠杆风险**: TQQQ是3倍杠杆ETF，波动较大
- **市场风险**: 股市有风险，投资需谨慎
- **技术风险**: 依赖网络连接和IB Gateway稳定性

### 使用前准备
1. **IB Gateway**: 确保IB Gateway已启动并监听端口4001
2. **账户资金**: 确保账户有足够资金进行交易
3. **网络连接**: 确保网络连接稳定
4. **权限设置**: 确保账户有交易TQQQ的权限

## 🔧 配置说明

### 连接参数
```python
host = '127.0.0.1'    # IB Gateway地址
port = 4001           # IB Gateway端口
client_id = 444       # 客户端ID
```

### 策略参数
```python
ema_period = 20       # EMA周期
position_percentage = 0.1  # 仓位比例 (10%)
check_time = '21:20'  # 检查时间 (北京时间)
```

## 📈 策略监控

- **日志文件**: `tqqq_trading.log`
- **实时输出**: 控制台显示
- **交易记录**: IB账户历史

## 🧪 测试功能

### 组件测试
- 连接IB Gateway测试
- 合约创建测试
- 历史数据获取测试
- EMA计算测试
- 账户信息测试
- 当前价格获取测试
- 仓位计算测试
- 时间检查测试
- 交易条件分析测试

### 手动交易测试
- 小额实盘交易测试（1%资金）
- 订单执行监控
- 交易结果验证

## 🔄 策略优化建议

1. **参数调整**: 可以调整EMA周期和资金比例
2. **风险控制**: 可以添加止损和止盈机制
3. **信号优化**: 可以结合其他技术指标
4. **时间优化**: 可以调整检查时间频率

## 📞 技术支持

如果遇到问题，请检查：
1. IB Gateway是否正常运行
2. 网络连接是否正常
3. 账户权限是否正确
4. Python环境和依赖是否正确安装

## 🛠️ 环境问题解决

如果遇到Python环境问题：
1. 运行 `环境检测.bat` 诊断问题
2. 查看 `Python环境问题解决.md` 获取详细解决方案
3. 运行 `启动TQQQ策略.bat` 自动创建虚拟环境

## 技术栈

- **Python**: 主要编程语言
- **ib_async**: IB API异步客户端（第三方库）
- **pandas**: 数据处理
- **numpy**: 数值计算
- **pytz**: 时区处理

## 📄 许可证

- **您的策略**: 基于BSD许可证开源
- **ib_async库**: 基于BSD许可证开源

## 免责声明

本项目仅供学习和研究使用。交易有风险，投资需谨慎。作者不对任何投资损失承担责任。

## 贡献

欢迎提交Issue和Pull Request来改进这个项目。

---

**注意**: 
- 您的交易策略在 `ib_async/` 目录中
- 详细使用说明请查看 `策略说明.md`
- 如遇Python环境问题，请查看 `Python环境问题解决.md`
