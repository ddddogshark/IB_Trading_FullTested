# TQQQæ™ºèƒ½äº¤æ˜“ç­–ç•¥è¯´æ˜æ–‡æ¡£

## ğŸ“Š ç­–ç•¥æ¦‚è¿°

TQQQæ™ºèƒ½äº¤æ˜“ç­–ç•¥æ˜¯ä¸€ä¸ªåŸºäºEMA20ç§»åŠ¨å¹³å‡çº¿çš„è‡ªåŠ¨åŒ–äº¤æ˜“ç­–ç•¥ï¼Œä¸“é—¨ç”¨äºäº¤æ˜“TQQQï¼ˆ3å€æ æ†çº³æ–¯è¾¾å…‹ETFï¼‰ã€‚

## ğŸ¯ ç­–ç•¥æ ¸å¿ƒé€»è¾‘

### äº¤æ˜“ä¿¡å·
- **ä¹°å…¥æ¡ä»¶**: æ˜¨æ—¥TQQQæ”¶ç›˜ä»· > EMA20ç§»åŠ¨å¹³å‡çº¿
- **ä»“ä½å¤§å°**: è´¦æˆ·æ€»èµ„é‡‘çš„10%
- **äº¤æ˜“æ—¶é—´**: æ¯å¤©åŒ—äº¬æ—¶é—´21:20è‡ªåŠ¨æ£€æŸ¥
- **äº¤æ˜“æ¨¡å¼**: å®ç›˜äº¤æ˜“ï¼ˆå°†å®é™…æ‰£æ¬¾ï¼‰

## ğŸ”„ ç­–ç•¥æ‰§è¡Œæµç¨‹

### ç¬¬ä¸€æ­¥ï¼šç¯å¢ƒåˆå§‹åŒ–
```python
# 1. åˆ›å»ºç­–ç•¥å®ä¾‹
strategy = TQQQSmartTradingStrategy(
    host='127.0.0.1',    # IB Gatewayåœ°å€
    port=4001,           # IB Gatewayç«¯å£
    client_id=444        # å®¢æˆ·ç«¯ID
)
```

### ç¬¬äºŒæ­¥ï¼šè¿æ¥IB Gateway
```python
# 2. è¿æ¥åˆ°Interactive Brokers Gateway
def connect_to_ib(self):
    self.ib = IB()
    self.ib.connect(self.host, self.port, clientId=self.client_id, timeout=20)
```
- å»ºç«‹ä¸IB Gatewayçš„è¿æ¥
- éªŒè¯è¿æ¥çŠ¶æ€
- è®¾ç½®è¶…æ—¶æ—¶é—´

### ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºäº¤æ˜“åˆçº¦
```python
# 3. åˆ›å»ºTQQQè‚¡ç¥¨åˆçº¦
def create_contracts(self):
    self.tqqq_contract = Stock('TQQQ', 'SMART', 'USD')
    tqqq_contracts = self.ib.qualifyContracts(self.tqqq_contract)
```
- åˆ›å»ºTQQQè‚¡ç¥¨åˆçº¦å¯¹è±¡
- éªŒè¯åˆçº¦ä¿¡æ¯
- ç¡®ä¿åˆçº¦å¯ç”¨

### ç¬¬å››æ­¥ï¼šè·å–å†å²æ•°æ®
```python
# 4. è·å–TQQQå†å²ä»·æ ¼æ•°æ®
def get_historical_data(self, contract, duration='30 D'):
    bars = self.ib.reqHistoricalData(
        contract,
        endDateTime='',
        durationStr=duration,
        barSizeSetting='1 day',
        whatToShow='TRADES',
        useRTH=True
    )
```
- è·å–30å¤©çš„æ—¥çº¿æ•°æ®
- åŒ…å«å¼€ç›˜ä»·ã€æœ€é«˜ä»·ã€æœ€ä½ä»·ã€æ”¶ç›˜ä»·
- ç”¨äºè®¡ç®—æŠ€æœ¯æŒ‡æ ‡

### ç¬¬äº”æ­¥ï¼šè®¡ç®—æŠ€æœ¯æŒ‡æ ‡
```python
# 5. è®¡ç®—EMA20ç§»åŠ¨å¹³å‡çº¿
def calculate_ema(self, prices, period=20):
    return prices.ewm(span=period).mean()
```
- è®¡ç®—20æ—¥æŒ‡æ•°ç§»åŠ¨å¹³å‡çº¿
- ä½¿ç”¨pandasçš„ewmå‡½æ•°
- å¹³æ»‘ä»·æ ¼æ³¢åŠ¨

### ç¬¬å…­æ­¥ï¼šåˆ†æäº¤æ˜“æ¡ä»¶
```python
# 6. åˆ†ææ˜¯å¦æ»¡è¶³äº¤æ˜“æ¡ä»¶
def analyze_trading_conditions(self):
    # è·å–æ˜¨æ—¥æ•°æ®
    yesterday_close = tqqq_data.iloc[-2]['close']  # æ˜¨æ—¥æ”¶ç›˜ä»·
    yesterday_ema20 = tqqq_data.iloc[-2]['ema20']  # æ˜¨æ—¥EMA20
    
    # åˆ¤æ–­ä¿¡å·
    if yesterday_close > yesterday_ema20:
        return True, current_price  # æ»¡è¶³ä¹°å…¥æ¡ä»¶
    else:
        return False, current_price  # ä¸æ»¡è¶³æ¡ä»¶
```

### ç¬¬ä¸ƒæ­¥ï¼šè·å–è´¦æˆ·ä¿¡æ¯
```python
# 7. è·å–è´¦æˆ·æ€»ä»·å€¼
def get_account_value(self):
    account_values = self.ib.accountSummary()
    for value in account_values:
        if value.tag == 'NetLiquidation' and value.currency == 'USD':
            return float(value.value)
```
- è·å–è´¦æˆ·å‡€èµ„äº§
- ç”¨äºè®¡ç®—ä»“ä½å¤§å°

### ç¬¬å…«æ­¥ï¼šè®¡ç®—ä»“ä½å¤§å°
```python
# 8. è®¡ç®—ä¹°å…¥è‚¡æ•°
def calculate_position_size(self, percentage=0.1):
    account_value = self.get_account_value()
    available_funds = account_value * percentage  # 10%èµ„é‡‘
    current_price = self.get_current_tqqq_price()
    quantity = int(available_funds / current_price)  # å‘ä¸‹å–æ•´
```
- ä½¿ç”¨è´¦æˆ·èµ„é‡‘çš„10%
- æ ¹æ®å½“å‰ä»·æ ¼è®¡ç®—å¯ä¹°å…¥è‚¡æ•°
- ç¡®ä¿è‡³å°‘ä¹°å…¥1è‚¡

### ç¬¬ä¹æ­¥ï¼šè·å–å½“å‰ä»·æ ¼
```python
# 9. è·å–TQQQå®æ—¶ä»·æ ¼
def get_current_tqqq_price(self):
    ticker = self.ib.reqMktData(self.tqqq_contract)
    # ç­‰å¾…ä»·æ ¼æ•°æ®
    while time.time() - start_time < max_wait:
        if ticker.marketPrice() > 0:
            return ticker.marketPrice()
```
- è·å–TQQQå®æ—¶å¸‚åœºä»·æ ¼
- å¦‚æœæ— æ³•è·å–å®æ—¶ä»·æ ¼ï¼Œä½¿ç”¨å†å²æ•°æ®

### ç¬¬åæ­¥ï¼šæ‰§è¡Œä¹°å…¥è®¢å•
```python
# 10. ä¸‹ä¹°å•
def place_buy_order(self, percentage=0.1):
    quantity = self.calculate_position_size(percentage)
    order = MarketOrder('BUY', quantity)  # å¸‚ä»·å•
    order.outsideRth = True  # å…è®¸å¸¸è§„äº¤æ˜“æ—¶é—´ä»¥å¤–äº¤æ˜“
    trade = self.ib.placeOrder(self.tqqq_contract, order)
```
- åˆ›å»ºå¸‚ä»·ä¹°å•
- æ”¯æŒå¸¸è§„äº¤æ˜“æ—¶é—´ä»¥å¤–äº¤æ˜“
- ç›‘æ§è®¢å•æ‰§è¡ŒçŠ¶æ€

### ç¬¬åä¸€æ­¥ï¼šæ—¶é—´æ£€æŸ¥
```python
# 11. æ£€æŸ¥æ˜¯å¦åº”è¯¥æ‰§è¡Œç­–ç•¥
def should_check_today(self):
    beijing_time = datetime.now(self.beijing_tz)
    current_time = beijing_time.time()
    target_time = datetime.strptime('21:20', '%H:%M').time()
    
    # å…è®¸5åˆ†é’Ÿè¯¯å·®
    time_diff = abs((current_time.hour * 60 + current_time.minute) - 
                  (target_time.hour * 60 + target_time.minute))
    
    return time_diff <= 5
```
- æ£€æŸ¥å½“å‰åŒ—äº¬æ—¶é—´
- åœ¨21:20Â±5åˆ†é’Ÿå†…æ‰§è¡Œç­–ç•¥
- é¿å…é‡å¤æ‰§è¡Œ

## ğŸ“… ç­–ç•¥æ‰§è¡Œæ—¶é—´è¡¨

| æ—¶é—´ | æ“ä½œ | è¯´æ˜ |
|------|------|------|
| æ¯å¤©21:20 | è‡ªåŠ¨æ£€æŸ¥ | æ£€æŸ¥äº¤æ˜“æ¡ä»¶ |
| æ»¡è¶³æ¡ä»¶æ—¶ | ç«‹å³ä¹°å…¥ | ä½¿ç”¨10%è´¦æˆ·èµ„é‡‘ |
| ä¸æ»¡è¶³æ¡ä»¶ | è·³è¿‡ | ç­‰å¾…ä¸‹ä¸€å¤© |

## âš ï¸ é£é™©æç¤º

1. **å®ç›˜äº¤æ˜“**: è¿™æ˜¯å®ç›˜äº¤æ˜“ç­–ç•¥ï¼Œå°†å®é™…æ‰£æ¬¾å¹¶æ‰§è¡Œäº¤æ˜“
2. **æ æ†é£é™©**: TQQQæ˜¯3å€æ æ†ETFï¼Œæ³¢åŠ¨è¾ƒå¤§
3. **å¸‚åœºé£é™©**: è‚¡å¸‚æœ‰é£é™©ï¼ŒæŠ•èµ„éœ€è°¨æ…
4. **æŠ€æœ¯é£é™©**: ä¾èµ–ç½‘ç»œè¿æ¥å’ŒIB Gatewayç¨³å®šæ€§

## ğŸ”§ ä½¿ç”¨å‰å‡†å¤‡

1. **å®‰è£…IB Gateway**: ç¡®ä¿IB Gatewayå·²å¯åŠ¨å¹¶ç›‘å¬ç«¯å£4001
2. **è´¦æˆ·èµ„é‡‘**: ç¡®ä¿è´¦æˆ·æœ‰è¶³å¤Ÿèµ„é‡‘è¿›è¡Œäº¤æ˜“
3. **ç½‘ç»œè¿æ¥**: ç¡®ä¿ç½‘ç»œè¿æ¥ç¨³å®š
4. **æƒé™è®¾ç½®**: ç¡®ä¿è´¦æˆ·æœ‰äº¤æ˜“TQQQçš„æƒé™

## ğŸ“ æ–‡ä»¶è¯´æ˜

- `tqqq_final_trading.py`: ä¸»ç­–ç•¥æ–‡ä»¶
- `test_strategy.py`: ç­–ç•¥æµ‹è¯•æ–‡ä»¶
- `å¯åŠ¨ç­–ç•¥.bat`: ç­–ç•¥å¯åŠ¨è„šæœ¬
- `æµ‹è¯•ç­–ç•¥.bat`: ç­–ç•¥æµ‹è¯•è„šæœ¬
- `requirements.txt`: ä¾èµ–åŒ…åˆ—è¡¨

## ğŸš€ å¯åŠ¨æ–¹å¼

1. **ç›´æ¥å¯åŠ¨**: åŒå‡» `å¯åŠ¨ç­–ç•¥.bat`
2. **æµ‹è¯•æ¨¡å¼**: åŒå‡» `æµ‹è¯•ç­–ç•¥.bat`
3. **æ‰‹åŠ¨è¿è¡Œ**: 
   ```bash
   cd ib_async
   venv\Scripts\activate
   python tqqq_final_trading.py
   ```

## ğŸ“Š ç­–ç•¥ç›‘æ§

- æ—¥å¿—æ–‡ä»¶: `tqqq_trading.log`
- å®æ—¶è¾“å‡º: æ§åˆ¶å°æ˜¾ç¤º
- äº¤æ˜“è®°å½•: IBè´¦æˆ·å†å²

## ğŸ”„ ç­–ç•¥ä¼˜åŒ–å»ºè®®

1. **å‚æ•°è°ƒæ•´**: å¯ä»¥è°ƒæ•´EMAå‘¨æœŸå’Œèµ„é‡‘æ¯”ä¾‹
2. **é£é™©æ§åˆ¶**: å¯ä»¥æ·»åŠ æ­¢æŸå’Œæ­¢ç›ˆæœºåˆ¶
3. **ä¿¡å·ä¼˜åŒ–**: å¯ä»¥ç»“åˆå…¶ä»–æŠ€æœ¯æŒ‡æ ‡
4. **æ—¶é—´ä¼˜åŒ–**: å¯ä»¥è°ƒæ•´æ£€æŸ¥æ—¶é—´é¢‘ç‡ 