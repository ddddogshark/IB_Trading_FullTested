# TQQQ智能交易策略

## 策略概述

这是一个基于EMA20技术指标的TQQQ自动化交易策略，支持持续运行和定时检查。

## 策略条件

### 买入条件
1. **EMA20信号**: 昨日TQQQ收盘价 > EMA20
2. **时间条件**: 每天北京时间21:20检查（允许±5分钟误差）

### 交易规则
- 满足条件时买入账户资金的10%
- 自动计算可买入股数（向下取整）
- 使用市价单
- 支持常规交易时间以外的交易
- 实盘交易，将实际扣款

## 功能特点

### 1. 持续运行模式
- 程序启动后将持续运行直到手动关闭
- 支持Ctrl+C安全退出
- 自动重连机制

### 2. 定时检查
- 每天北京时间21:20自动检查策略条件
- 避免重复交易（每天只检查一次）
- 时区自动处理

### 3. 数据获取
- 自动获取TQQQ历史数据
- 实时计算EMA20指标
- 自动获取账户资金信息
- 实时获取TQQQ当前价格

### 4. 日志记录
- 详细的操作日志
- 同时输出到控制台和文件
- 记录所有交易决策和结果

## 快速开始

### 1. 环境要求
- Python 3.10+
- Interactive Brokers Gateway
- 有效的IB账户

### 2. 一键启动
```bash
# 双击运行启动脚本（推荐）
启动策略.bat
```

启动脚本会自动：
- 检查Python是否安装
- 检查并安装所需依赖
- 启动交易策略

### 3. 手动启动
```bash
# 安装依赖
pip install pandas numpy pytz ib_async

# 启动策略
python tqqq_final_trading.py
```

### 4. 安全退出
- 按 `Ctrl+C` 安全退出程序
- 程序会自动断开IB连接

## 配置说明

### IB连接配置
```python
strategy = TQQQSmartTradingStrategy(
    host='127.0.0.1',    # IB Gateway地址
    port=4001,           # IB Gateway端口
    client_id=444        # 客户端ID
)
```

### 策略参数
- **EMA周期**: 20（可在代码中修改）
- **检查时间**: 北京时间21:20（可在代码中修改）
- **仓位比例**: 账户资金的10%（可在代码中修改）
- **最小股数**: 至少买入1股（安全保护）

## 日志文件

程序运行时会生成以下日志文件：
- `tqqq_trading.log`: 详细的操作日志

## 安全提醒

⚠️ **重要警告**:
- 这是实盘交易策略，将实际扣款
- 请在充分测试后再使用
- 建议先使用模拟账户测试
- 请确保IB Gateway已正确配置

## 故障排除

### 常见问题

1. **Python未找到**
   - 确保Python已安装并添加到系统PATH
   - 运行 `python --version` 检查Python版本

2. **依赖包缺失**
   - 启动脚本会自动安装依赖
   - 或手动运行 `pip install pandas numpy pytz ib_async`

3. **连接失败**
   - 检查IB Gateway是否运行
   - 确认端口和客户端ID配置正确

4. **数据获取失败**
   - 检查网络连接
   - 确认IB账户有相应权限

5. **时区问题**
   - 程序使用pytz处理时区
   - 自动处理夏令时

## 更新日志

### v2.0 (当前版本)
- ✅ 实现持续运行模式
- ✅ 添加定时检查功能（北京时间21:20）
- ✅ 使用EMA20技术指标
- ✅ 改进日志记录
- ✅ 添加安全退出机制
- ✅ 简化安装和使用流程
- ✅ 一键启动脚本（自动检查和安装依赖）

### v1.0 (原版本)
- 基于已知数据的简单策略
- 单次运行模式
- 使用EMA30指标

## 技术支持

如有问题，请检查：
1. 日志文件中的错误信息
2. IB Gateway连接状态
3. 网络连接和权限设置 