# 🚀 TQQQ智能交易策略快速部署指南

## 📋 部署前准备

### 系统要求
- **操作系统**: Windows 10+, Ubuntu 18.04+, CentOS 7+
- **内存**: 最少2GB，推荐4GB+
- **存储**: 最少1GB可用空间
- **网络**: 稳定的互联网连接

### 必需软件
- **Python**: 3.8+ (推荐3.12)
- **Git**: 最新版本
- **IB Gateway**: 已配置并运行

## 🎯 推荐部署方案

### 方案一：一键部署（推荐）

#### Linux/macOS
```bash
# 下载部署脚本
curl -fsSL https://raw.githubusercontent.com/ddddogshark/IB_Trading/main/deploy.sh -o deploy.sh
chmod +x deploy.sh

# 运行部署
./deploy.sh -d  # Docker部署
# 或
./deploy.sh -t  # 传统部署
```

#### Windows
```cmd
# 下载Windows部署脚本
curl -fsSL https://raw.githubusercontent.com/ddddogshark/IB_Trading/main/deploy-windows.bat -o deploy-windows.bat

# 运行部署
deploy-windows.bat
```

### 方案二：手动部署

#### 1. 克隆项目
```bash
git clone https://github.com/ddddogshark/IB_Trading.git
cd IB_Trading
```

#### 2. 创建虚拟环境
```bash
# Linux/macOS
python3.12 -m venv venv
source venv/bin/activate

# Windows
python -m venv venv
venv\Scripts\activate
```

#### 3. 安装依赖
```bash
pip install -r requirements.txt
```

#### 4. 启动策略
```bash
python ib_async/tqqq_final_trading.py
```

## 🐳 Docker部署（生产环境推荐）

### 快速启动
```bash
# 克隆项目
git clone https://github.com/ddddogshark/IB_Trading.git
cd IB_Trading

# 启动服务
docker-compose up -d

# 查看日志
docker-compose logs -f tqqq-trading
```

### 管理命令
```bash
# 停止服务
docker-compose down

# 重启服务
docker-compose restart tqqq-trading

# 更新代码
git pull
docker-compose build --no-cache
docker-compose up -d
```

## 🔧 配置说明

### 环境变量配置
创建 `.env` 文件：
```bash
# IB Gateway配置
IB_HOST=127.0.0.1
IB_PORT=4001
IB_CLIENT_ID=444

# 策略配置
EMA_PERIOD=20
POSITION_PERCENTAGE=0.1
CHECK_TIME=21:20

# 日志配置
LOG_LEVEL=INFO
LOG_FILE=tqqq_trading.log
```

### 策略参数调整
编辑 `ib_async/tqqq_final_trading.py` 中的参数：
```python
# 连接配置
self.host = '127.0.0.1'      # IB Gateway地址
self.port = 4001             # IB Gateway端口
self.client_id = 444         # 客户端ID

# 策略参数
ema_period = 20              # EMA周期
position_percentage = 0.1    # 仓位比例（10%）
check_time = "21:20"         # 检查时间（北京时间）
```

## 📊 监控和管理

### 查看运行状态
```bash
# 查看进程
ps aux | grep tqqq_final_trading

# 查看日志
tail -f logs/tqqq_trading.log

# 查看Docker容器状态
docker-compose ps
```

### 自动监控
```bash
# 启用监控脚本
chmod +x monitor.sh
./monitor.sh

# 添加到定时任务（Linux）
echo "*/5 * * * * $(pwd)/monitor.sh" | crontab -
```

## 🧪 测试部署

### 运行测试
```bash
# 完整测试
python ib_async/test_strategy.py

# 快速测试
python ib_async/debug_test.py

# Windows测试
test-trading.bat
```

### 测试检查项
- [ ] Python环境正常
- [ ] 依赖包安装完整
- [ ] IB Gateway连接成功
- [ ] 策略类实例化成功
- [ ] 历史数据获取正常
- [ ] EMA计算正确

## 🔒 安全配置

### 防火墙设置
```bash
# Linux
sudo ufw allow 22/tcp    # SSH
sudo ufw allow 4001/tcp  # IB Gateway
sudo ufw enable

# Windows
netsh advfirewall firewall add rule name="IB Gateway" dir=in action=allow protocol=TCP localport=4001
```

### 用户权限
```bash
# 创建专用用户
sudo useradd -m -s /bin/bash trading
sudo chown -R trading:trading /home/trading/IB_Trading
sudo chmod 700 /home/trading/IB_Trading
```

## 🆘 常见问题

### 1. Python环境问题
```bash
# 检查Python版本
python --version

# 重新安装虚拟环境
rm -rf venv
python3.12 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

### 2. IB Gateway连接失败
```bash
# 检查端口
netstat -an | grep 4001

# 检查IB Gateway进程
ps aux | grep ibgateway

# 重启IB Gateway
sudo systemctl restart ib-gateway
```

### 3. 依赖包安装失败
```bash
# 升级pip
pip install --upgrade pip

# 使用国内镜像
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple/
```

### 4. 权限问题
```bash
# 修复文件权限
sudo chown -R $USER:$USER .
chmod +x *.sh *.bat

# 修复虚拟环境权限
chmod +x venv/bin/activate
```

## 📞 技术支持

### 获取帮助
1. **查看日志**: `tail -f logs/tqqq_trading.log`
2. **运行测试**: `python ib_async/test_strategy.py`
3. **检查配置**: 确认IB Gateway和账户设置
4. **联系支持**: 提供错误日志和系统信息

### 有用的命令
```bash
# 查看系统信息
uname -a
python --version
pip list

# 查看网络连接
netstat -an | grep 4001
ping 127.0.0.1

# 查看磁盘空间
df -h
du -sh *
```

## 🎉 部署完成

部署成功后，您将看到：
- ✅ 策略进程正常运行
- ✅ 日志文件正常生成
- ✅ IB Gateway连接成功
- ✅ 定时检查功能正常

现在您的TQQQ智能交易策略已经准备就绪！ 